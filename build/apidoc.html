<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/pstadler/flightplan"

    >flightplan (v0.6.15)</a>
</h1>
<h4>Library for streamlining application deployment or systems administration tasks</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan">module flightplan</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell">
            function <span class="apidocSignatureSpan">flightplan.</span>shell
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh">
            function <span class="apidocSignatureSpan">flightplan.</span>ssh
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>_flights</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>_targets</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>errors</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>local</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>remote</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>runtime</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>shell.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>ssh.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.errors">module flightplan.errors</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.AbortedError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>AbortedError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.BaseError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>BaseError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.CommandExitedAbnormallyError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>CommandExitedAbnormallyError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.ConnectionFailedError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>ConnectionFailedError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.InvalidArgumentError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidArgumentError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.InvalidTargetError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidTargetError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.ProcessInterruptedError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>ProcessInterruptedError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.local">module flightplan.local</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.local.run">
            function <span class="apidocSignatureSpan">flightplan.local.</span>run
            <span class="apidocSignatureSpan">(fn, context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.remote">module flightplan.remote</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.remote.disconnect">
            function <span class="apidocSignatureSpan">flightplan.remote.</span>disconnect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.remote.run">
            function <span class="apidocSignatureSpan">flightplan.remote.</span>run
            <span class="apidocSignatureSpan">(fn, context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.shell">module flightplan.shell</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.shell">
            function <span class="apidocSignatureSpan">flightplan.</span>shell
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.super_">
            function <span class="apidocSignatureSpan">flightplan.shell.</span>super_
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.shell.prototype">module flightplan.shell.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.prototype._exec">
            function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>_exec
            <span class="apidocSignatureSpan">(command, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.prototype.transfer">
            function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>transfer
            <span class="apidocSignatureSpan">(files, remoteDir, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.ssh">module flightplan.ssh</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.ssh">
            function <span class="apidocSignatureSpan">flightplan.</span>ssh
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.super_">
            function <span class="apidocSignatureSpan">flightplan.ssh.</span>super_
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.ssh.prototype">module flightplan.ssh.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.prototype._exec">
            function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>_exec
            <span class="apidocSignatureSpan">(command, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.prototype.close">
            function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan" id="apidoc.module.flightplan">module flightplan</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.shell" id="apidoc.element.flightplan.shell">
        function <span class="apidocSignatureSpan">flightplan.</span>shell
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Shell(context) {
  Shell.super_.call(this, context);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.ssh" id="apidoc.element.flightplan.ssh">
        function <span class="apidocSignatureSpan">flightplan.</span>ssh
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SSH(context) {
  SSH.super_.call(this, context);

  var config = extend({}, context.remote); // clone

  if(config.tryKeyboard !== false) {
    config.tryKeyboard = true;
    config.readyTimeout = config.readyTimeout || 30000;
  }

  if(config.privateKey) {
    config.privateKey = fs.readFileSync(config.privateKey, { encoding: &#x27;utf8&#x27; });
  }

  var self = this;

  var fiber = Fiber.current;

  this._connection = new Connection();

  this._connection.on(&#x27;keyboard-interactive&#x27;, function next(name, instructions,
                                    instructionsLang, prompts, finish, answers) {
    answers = answers || [];

    var currentPrompt = prompts[answers.length];

    if(answers.length &#x3c; prompts.length) {
      new Fiber(function() {
        var answer = self.prompt(currentPrompt.prompt, { hidden: !currentPrompt.echo });
        answers.push(answer);

        next(name, instructions, instructionsLang, prompts, finish, answers);
      }).run();
    } else {
      finish(answers);
    }
  });

  this._connection.on(&#x27;ready&#x27;, function() {
    fiber.run();
  });

  this._connection.on(&#x27;error&#x27;, function(err) {
    return fiber.throwInto(err);
  });

  this._connection.connect(config);

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.errors" id="apidoc.module.flightplan.errors">module flightplan.errors</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.errors.AbortedError" id="apidoc.element.flightplan.errors.AbortedError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>AbortedError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbortedError(message) {
  AbortedError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * ```javascript
 * plan.abort(&#x27;Severe turbulences over the atlantic ocean!&#x27;);
 * ```
 *
 * @method abort([message])
 */
Flightplan.prototype.abort = function(message) {
  throw new errors.<span class="apidocCodeKeywordSpan">AbortedError</span>(message || &#x27;Flightplan aborted&#x27;);
};

Flightplan.prototype.availableTargets = function() {
  return Object.keys(this._targets);
};

Flightplan.prototype.availableTasks = function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.BaseError" id="apidoc.element.flightplan.errors.BaseError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>BaseError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function BaseError(message) {
  BaseError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.message = message;
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

expect(LOGGER_STUB.error.lastCall.args[0]).to.equal(ERROR.stack);
expect(process.exit.calledOnce).to.be.true;
expect(process.exit.lastCall.args[0]).to.equal(1);
    });

    it(&#x27;should catch uncaught custom errors and exit&#x27;, function() {
var ERROR = new errors.<span class="apidocCodeKeywordSpan">BaseError</span>(&#x27;some custom error&#x27;);

var fn = process.on.withArgs(&#x27;uncaughtException&#x27;).lastCall.args[1];

fn(ERROR);

expect(LOGGER_STUB.error.lastCall.args[0]).to.equal(ERROR.message);
expect(process.exit.calledOnce).to.be.true;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.CommandExitedAbnormallyError" id="apidoc.element.flightplan.errors.CommandExitedAbnormallyError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>CommandExitedAbnormallyError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function CommandExitedAbnormallyError(message) {
  CommandExitedAbnormallyError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  if(result.code === 0) {
    self._logger.success(&#x27;ok&#x27;);
  } else if(options.failsafe) {
    self._logger.warn(&#x27;failed safely (&#x27; + result.code + &#x27;)&#x27;);
  } else {
    self._logger.error(&#x27;failed (&#x27; + result.code + &#x27;)&#x27;);

    var error = new errors.<span class="apidocCodeKeywordSpan">CommandExitedAbnormallyError</span>(
                &#x27;Command exited abnormally on &#x27; + self._context.remote.host);

    return fiber.throwInto(error);
  }

  fiber.run(result);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.ConnectionFailedError" id="apidoc.element.flightplan.errors.ConnectionFailedError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>ConnectionFailedError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ConnectionFailedError(message) {
  ConnectionFailedError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
logger.info(&#x22;Connecting to &#x27;&#x22; + _context.remote.host + &#x22;&#x27;&#x22;);

try {
  var connection = new SSH(_context);
  _connections.push(connection);
} catch(e) {
  if(!_context.remote.failsafe) {
    throw new errors.<span class="apidocCodeKeywordSpan">ConnectionFailedError</span>(&#x22;Error connecting to &#x27;&#x22; +
                          _context.remote.host + &#x22;&#x27;: &#x22; + e.message);
  }

  logger.warn(&#x22;Safely failed connecting to &#x27;&#x22; +
                _context.remote.host + &#x22;&#x27;: &#x22; + e.message);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.InvalidArgumentError" id="apidoc.element.flightplan.errors.InvalidArgumentError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidArgumentError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function InvalidArgumentError(message) {
  InvalidArgumentError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return Fiber.yield();
};

Shell.prototype.transfer = function(files, remoteDir, options) {
options = extend(extend({}, this._options), options); // clone and extend

if(!remoteDir) {
  throw new errors.<span class="apidocCodeKeywordSpan">InvalidArgumentError</span>(&#x27;Missing remote path for transfer()&#x27
;);
}

if(Array.isArray(files)) {
  files = files.join(&#x27;\n&#x27;);
} else if(files instanceof Object) {
  if(!files.hasOwnProperty(&#x27;stdout&#x27;)) {
    throw new errors.InvalidArgumentError(&#x27;Invalid object passed to transfer()&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.InvalidTargetError" id="apidoc.element.flightplan.errors.InvalidTargetError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidTargetError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function InvalidTargetError(message) {
  InvalidTargetError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
options = options || {};

if(options.color !== undefined) {
  chalk.enabled = options.color;
}

if(!target) {
  throw new errors.<span class="apidocCodeKeywordSpan">InvalidTargetError</span>(&#x27;No target specified&#x27;);
}

if(Object.keys(this._targets).indexOf(target) === -1) {
  throw new errors.InvalidTargetError(
              format(&#x22;&#x27;%s&#x27; is not a valid target&#x22;, target));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.ProcessInterruptedError" id="apidoc.element.flightplan.errors.ProcessInterruptedError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>ProcessInterruptedError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ProcessInterruptedError(message) {
  ProcessInterruptedError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function Flightplan() {
this._targets = {};
this._flights = [];

this.runtime = Object.freeze({});

process.on(&#x27;SIGINT&#x27;, function() {
  throw new errors.<span class="apidocCodeKeywordSpan">ProcessInterruptedError</span>(&#x27;Flightplan was interrupted&#x27;);
});

process.on(&#x27;uncaughtException&#x27;, function(err) {
  logger.error(err instanceof errors.BaseError ? err.message : err.stack);

  process.exit(1);
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.local" id="apidoc.module.flightplan.local">module flightplan.local</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.local.run" id="apidoc.element.flightplan.local.run">
        function <span class="apidocSignatureSpan">flightplan.local.</span>run
        <span class="apidocSignatureSpan">(fn, context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (fn, context) {
  var _context = extend({}, context);
  _context.remote = { host: &#x27;localhost&#x27; };

  var future = new Future();

  var task = function() {
    var transport = new Shell(_context);

    new Fiber(function() {
      fn(transport);
      return future.return();
    }).run();

    return future;
  };

  var t = process.hrtime();

  logger.info(&#x27;Executing local task&#x27;);

  Future.wait(task());

  logger.info(&#x27;Local task finished after &#x27; + prettyTime(process.hrtime(t)));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      &#x27;Available targets:\n&#x27; +
      &#x27;  &#x27; + instance.availableTargets().join(&#x27;\n  &#x27;) + &#x27;\n&#x27;
    );

    process.exit(1);
  }

  instance.<span class="apidocCodeKeywordSpan">run</span>(task, target, options);
};

cli.launch({
  configPath: options.flightplan
}, invoke);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.remote" id="apidoc.module.flightplan.remote">module flightplan.remote</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.remote.disconnect" id="apidoc.element.flightplan.remote.disconnect">
        function <span class="apidocSignatureSpan">flightplan.remote.</span>disconnect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disconnect = function () {
  _connections.forEach(function(connection) {
    connection.close();
  });

  _connections = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   // Execute flights
   var t = process.hrtime();

   flights.forEach(function(f) {
     flight.run(f.type, f.fn, context);
   });

   flight.<span class="apidocCodeKeywordSpan">disconnect</span>();

   logger.info(&#x27;Flightplan finished after &#x27; + prettyTime(process.hrtime(t)));
 }).run();
};

/**
* Manually abort the current flightplan and prevent any further commands and
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.remote.run" id="apidoc.element.flightplan.remote.run">
        function <span class="apidocSignatureSpan">flightplan.remote.</span>run
        <span class="apidocSignatureSpan">(fn, context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (fn, context) {
  if(_connections.length === 0) {
    Future.wait(context.hosts.map(function(host) {
      var _context = extend({}, context);
      _context.remote = host;

      return connect(_context);
    }));
  }

  Future.wait(_connections.map(function(connection) {
    return execute(connection, fn);
  }));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      &#x27;Available targets:\n&#x27; +
      &#x27;  &#x27; + instance.availableTargets().join(&#x27;\n  &#x27;) + &#x27;\n&#x27;
    );

    process.exit(1);
  }

  instance.<span class="apidocCodeKeywordSpan">run</span>(task, target, options);
};

cli.launch({
  configPath: options.flightplan
}, invoke);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.shell" id="apidoc.module.flightplan.shell">module flightplan.shell</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.shell.shell" id="apidoc.element.flightplan.shell.shell">
        function <span class="apidocSignatureSpan">flightplan.</span>shell
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Shell(context) {
  Shell.super_.call(this, context);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.shell.super_" id="apidoc.element.flightplan.shell.super_">
        function <span class="apidocSignatureSpan">flightplan.shell.</span>super_
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transport(context) {
  this._context = context;
  this._options = {
    silent: false,
    failsafe: false
  };
  this._execWith = &#x27;&#x27;;

  this._logger = logger({
    debug: this._context.options.debug,
    prefix: this._context.remote.host
  });

  this.runtime = Object.freeze(extend({}, this._context.remote)); // userland

  commands.forEach(function(command) {
    this[command] = function(args, options) {
      if(typeof args === &#x27;object&#x27;) {
        options = args;
        args = null;
      }

      var _command = format(&#x27;%s%s&#x27;, this._execWith, command);
      _command = args ? format(&#x27;%s %s&#x27;, _command, args) : _command;

      return this._exec(_command, options || {});
    };
  }, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.shell.prototype" id="apidoc.module.flightplan.shell.prototype">module flightplan.shell.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.shell.prototype._exec" id="apidoc.element.flightplan.shell.prototype._exec">
        function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>_exec
        <span class="apidocSignatureSpan">(command, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_exec = function (command, options) {
  options = options || {};

  var self = this;

  options = extend(extend({}, self._options), options); // clone and extend

  var result = {
    code: 0,
    stdout: null,
    stderr: null
  };

  self._logger.command(command);

  var fiber = Fiber.current;

  var proc = exec(command, extend({ maxBuffer: 1000 * 1024 }, options.exec));

  proc.stdout.on(&#x27;data&#x27;, function(data) {
    result.stdout = (result.stdout || &#x27;&#x27;) + data;
  });

  proc.stderr.on(&#x27;data&#x27;, function(data) {
    result.stderr = (result.stderr || &#x27;&#x27;) + data;
  });

  byline(proc.stdout).on(&#x27;data&#x27;, function(data) {
    if(!options.silent) {
      self._logger.stdout(String(data).trim());
    }
  });

  byline(proc.stderr).on(&#x27;data&#x27;, function(data) {
    self._logger[options.failsafe ? &#x27;stdwarn&#x27; : &#x27;stderr&#x27;](String(data));
  });

  proc.on(&#x27;close&#x27;, function(code) {
    result.code = code;

    if(result.code === 0) {
      self._logger.success(&#x27;ok&#x27;);
    } else if(options.failsafe) {
      self._logger.warn(&#x27;failed safely (&#x27; + result.code + &#x27;)&#x27;);
    } else {
      self._logger.error(&#x27;failed (&#x27; + result.code + &#x27;)&#x27;);

      var error = new errors.CommandExitedAbnormallyError(
                  &#x27;Command exited abnormally on &#x27; + self._context.remote.host);

      return fiber.throwInto(error);
    }

    fiber.run(result);
  });

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

  it(&#x27;should set up the `runtime` property&#x27;, function() {
    expect(transport.runtime).to.deep.equal(CONTEXT.remote);
  });

  it(&#x27;should throw when an abstract method gets called&#x27;, function() {
    expect(function() { transport.<span class="apidocCodeKeywordSpan">_exec</span>(); } ).to.throw(Error, &#x27;does not implement
&#x27;);
    expect(function() { transport.transfer(); } ).to.throw(Error, &#x27;does not implement&#x27;);
  });
});

describe(&#x27;#exec()&#x27;, function() {
  it(&#x27;should pass the correct command to #_exec()&#x27;, function() {
    transport._exec = sinon.stub();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.shell.prototype.transfer" id="apidoc.element.flightplan.shell.prototype.transfer">
        function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>transfer
        <span class="apidocSignatureSpan">(files, remoteDir, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">transfer = function (files, remoteDir, options) {
  options = extend(extend({}, this._options), options); // clone and extend

  if(!remoteDir) {
    throw new errors.InvalidArgumentError(&#x27;Missing remote path for transfer()&#x27;);
  }

  if(Array.isArray(files)) {
    files = files.join(&#x27;\n&#x27;);
  } else if(files instanceof Object) {
    if(!files.hasOwnProperty(&#x27;stdout&#x27;)) {
      throw new errors.InvalidArgumentError(&#x27;Invalid object passed to transfer()&#x27;);
    }

    files = files.stdout;
  }

  files = (files || &#x27;&#x27;).trim().replace(/[\r|\0]/mg, &#x27;\n&#x27;);

  if(!files) {
    throw new errors.InvalidArgumentError(&#x27;Empty file list passed to transfer()&#x27;);
  }

  var tmpFile = writeTempFile(files);

  var rsyncFlags = &#x27;-az&#x27; + (this._context.options.debug ? &#x27;vv&#x27; : &#x27;&#x27;);
  var results = [];

  var self = this;

  var task = function(remote) {
    var sshFlags = (remote.privateKey ? &#x27; -i &#x27; + remote.privateKey : &#x27;&#x27;);
    var remoteUrl = util.format(&#x27;%s%s:%s&#x27;,
                              (remote.username ? remote.username + &#x27;@&#x27; : &#x27;&#x27;),
                              remote.host, remoteDir);

    var command = util.format(&#x27;rsync --files-from %s %s --rsh=&#x22;ssh -p%s%s&#x22; ./ %s&#x27;,
                              tmpFile, rsyncFlags,
                              remote.port || 22, sshFlags, remoteUrl);

    var future = new Future();

    new Fiber(function() {
      results.push(self.exec(command, options));

      return future.return();
    }).run();

    return future;
  };

  var tasks = [];
  self._context.hosts.forEach(function(remote) {
    tasks.push(task(remote));
  });

  Future.wait(tasks);

  fs.unlink(tmpFile);

  return results;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
plan.local(function(local) {
local.log(&#x27;Run build&#x27;);
local.exec(&#x27;gulp build&#x27;);

local.log(&#x27;Copy files to remote hosts&#x27;);
var filesToCopy = local.exec(&#x27;git ls-files&#x27;, {silent: true});
// rsync files to all the target&#x27;s remote hosts
local.<span class="apidocCodeKeywordSpan">transfer</span>(filesToCopy, &#x27;/tmp/&#x27; + tmpDir);
});

// run commands on the target&#x27;s remote hosts
plan.remote(function(remote) {
remote.log(&#x27;Move folder to web root&#x27;);
remote.sudo(&#x27;cp -R /tmp/&#x27; + tmpDir + &#x27; ~&#x27;, {user: &#x27;www&#x27;});
remote.rm(&#x27;-rf /tmp/&#x27; + tmpDir);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.ssh" id="apidoc.module.flightplan.ssh">module flightplan.ssh</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.ssh.ssh" id="apidoc.element.flightplan.ssh.ssh">
        function <span class="apidocSignatureSpan">flightplan.</span>ssh
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SSH(context) {
  SSH.super_.call(this, context);

  var config = extend({}, context.remote); // clone

  if(config.tryKeyboard !== false) {
    config.tryKeyboard = true;
    config.readyTimeout = config.readyTimeout || 30000;
  }

  if(config.privateKey) {
    config.privateKey = fs.readFileSync(config.privateKey, { encoding: &#x27;utf8&#x27; });
  }

  var self = this;

  var fiber = Fiber.current;

  this._connection = new Connection();

  this._connection.on(&#x27;keyboard-interactive&#x27;, function next(name, instructions,
                                    instructionsLang, prompts, finish, answers) {
    answers = answers || [];

    var currentPrompt = prompts[answers.length];

    if(answers.length &#x3c; prompts.length) {
      new Fiber(function() {
        var answer = self.prompt(currentPrompt.prompt, { hidden: !currentPrompt.echo });
        answers.push(answer);

        next(name, instructions, instructionsLang, prompts, finish, answers);
      }).run();
    } else {
      finish(answers);
    }
  });

  this._connection.on(&#x27;ready&#x27;, function() {
    fiber.run();
  });

  this._connection.on(&#x27;error&#x27;, function(err) {
    return fiber.throwInto(err);
  });

  this._connection.connect(config);

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.ssh.super_" id="apidoc.element.flightplan.ssh.super_">
        function <span class="apidocSignatureSpan">flightplan.ssh.</span>super_
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transport(context) {
  this._context = context;
  this._options = {
    silent: false,
    failsafe: false
  };
  this._execWith = &#x27;&#x27;;

  this._logger = logger({
    debug: this._context.options.debug,
    prefix: this._context.remote.host
  });

  this.runtime = Object.freeze(extend({}, this._context.remote)); // userland

  commands.forEach(function(command) {
    this[command] = function(args, options) {
      if(typeof args === &#x27;object&#x27;) {
        options = args;
        args = null;
      }

      var _command = format(&#x27;%s%s&#x27;, this._execWith, command);
      _command = args ? format(&#x27;%s %s&#x27;, _command, args) : _command;

      return this._exec(_command, options || {});
    };
  }, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.ssh.prototype" id="apidoc.module.flightplan.ssh.prototype">module flightplan.ssh.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.ssh.prototype._exec" id="apidoc.element.flightplan.ssh.prototype._exec">
        function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>_exec
        <span class="apidocSignatureSpan">(command, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_exec = function (command, options) {
  options = options || {};

  var self = this;

  options = extend(extend({}, self._options), options); // clone and extend

  var result = {
    code: 0,
    stdout: null,
    stderr: null
  };

  self._logger.command(command);

  var fiber = Fiber.current;

  self._connection.exec(command, options.exec || {}, function(err, stream) {

    stream.on(&#x27;data&#x27;, function(data) {
      result.stdout = (result.stdout || &#x27;&#x27;) + data;
    });

    stream.stderr.on(&#x27;data&#x27;, function(data) {
      result.stderr = (result.stderr || &#x27;&#x27;) + data;
    });

    byline(stream, { keepEmptyLines: true }).on(&#x27;data&#x27;, function(data) {
      if(!options.silent) {
        self._logger.stdout(data);
      }
    });

    byline(stream.stderr, { keepEmptyLines: true }).on(&#x27;data&#x27;, function(data) {
      self._logger[options.failsafe ? &#x27;stdwarn&#x27; : &#x27;stderr&#x27;](data);
    });

    stream.on(&#x27;exit&#x27;, function(code) {
      result.code = code;
    });

    stream.on(&#x27;end&#x27;, function() {
      if(result.code === 0) {
        self._logger.success(&#x27;ok&#x27;);
      } else if(options.failsafe) {
        self._logger.warn(&#x27;failed safely (&#x27; + result.code + &#x27;)&#x27;);
      } else {
        self._logger.error(&#x27;failed (&#x27; + result.code + &#x27;)&#x27;);

        var error = new errors.CommandExitedAbnormallyError(
                  &#x27;Command exited abnormally on &#x27; + self._context.remote.host);

        return fiber.throwInto(error);
      }

      fiber.run(result);
    });
  });

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

  it(&#x27;should set up the `runtime` property&#x27;, function() {
    expect(transport.runtime).to.deep.equal(CONTEXT.remote);
  });

  it(&#x27;should throw when an abstract method gets called&#x27;, function() {
    expect(function() { transport.<span class="apidocCodeKeywordSpan">_exec</span>(); } ).to.throw(Error, &#x27;does not implement
&#x27;);
    expect(function() { transport.transfer(); } ).to.throw(Error, &#x27;does not implement&#x27;);
  });
});

describe(&#x27;#exec()&#x27;, function() {
  it(&#x27;should pass the correct command to #_exec()&#x27;, function() {
    transport._exec = sinon.stub();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.ssh.prototype.close" id="apidoc.element.flightplan.ssh.prototype.close">
        function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  this._connection.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    expect(LOGGER_STUB.debug.lastCall.args[0]).to.equal(&#x27;test message&#x27;);
  });
});

describe(&#x27;#close()&#x27;, function() {
  it(&#x27;should be an function&#x27;, function() {
    expect(transport.close).to.be.a(&#x27;function&#x27;);
    expect(transport.<span class="apidocCodeKeywordSpan">close</span>()).to.be.undefined;
  });
});

describe(&#x27;command shortcuts&#x27;, function() {
  it(&#x27;should be exposed&#x27;, function() {
    COMMANDS.forEach(function(command) {
      expect(transport[command]).to.be.a(&#x27;function&#x27;);
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
