<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/pstadler/flightplan">flightplan (v0.6.15)</a>
</h1>
<h4>Library for streamlining application deployment or systems administration tasks</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan">module flightplan</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell">
            function <span class="apidocSignatureSpan">flightplan.</span>shell
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh">
            function <span class="apidocSignatureSpan">flightplan.</span>ssh
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>_flights</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>_targets</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>errors</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>local</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>remote</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>runtime</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>shell.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">flightplan.</span>ssh.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.errors">module flightplan.errors</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.AbortedError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>AbortedError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.BaseError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>BaseError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.CommandExitedAbnormallyError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>CommandExitedAbnormallyError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.ConnectionFailedError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>ConnectionFailedError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.InvalidArgumentError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidArgumentError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.InvalidTargetError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidTargetError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.errors.ProcessInterruptedError">
            function <span class="apidocSignatureSpan">flightplan.errors.</span>ProcessInterruptedError
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.local">module flightplan.local</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.local.run">
            function <span class="apidocSignatureSpan">flightplan.local.</span>run
            <span class="apidocSignatureSpan">(fn, context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.remote">module flightplan.remote</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.remote.disconnect">
            function <span class="apidocSignatureSpan">flightplan.remote.</span>disconnect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.remote.run">
            function <span class="apidocSignatureSpan">flightplan.remote.</span>run
            <span class="apidocSignatureSpan">(fn, context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.shell">module flightplan.shell</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.shell">
            function <span class="apidocSignatureSpan">flightplan.</span>shell
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.super_">
            function <span class="apidocSignatureSpan">flightplan.shell.</span>super_
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.shell.prototype">module flightplan.shell.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.prototype._exec">
            function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>_exec
            <span class="apidocSignatureSpan">(command, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.shell.prototype.transfer">
            function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>transfer
            <span class="apidocSignatureSpan">(files, remoteDir, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.ssh">module flightplan.ssh</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.ssh">
            function <span class="apidocSignatureSpan">flightplan.</span>ssh
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.super_">
            function <span class="apidocSignatureSpan">flightplan.ssh.</span>super_
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.flightplan.ssh.prototype">module flightplan.ssh.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.prototype._exec">
            function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>_exec
            <span class="apidocSignatureSpan">(command, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.flightplan.ssh.prototype.close">
            function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan" id="apidoc.module.flightplan">module flightplan</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.shell" id="apidoc.element.flightplan.shell">
        function <span class="apidocSignatureSpan">flightplan.</span>shell
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Shell(context) {
  Shell.super_.call(this, context);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.ssh" id="apidoc.element.flightplan.ssh">
        function <span class="apidocSignatureSpan">flightplan.</span>ssh
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SSH(context) {
  SSH.super_.call(this, context);

  var config = extend({}, context.remote); // clone

  if(config.tryKeyboard !== false) {
    config.tryKeyboard = true;
    config.readyTimeout = config.readyTimeout || 30000;
  }

  if(config.privateKey) {
    config.privateKey = fs.readFileSync(config.privateKey, { encoding: 'utf8' });
  }

  var self = this;

  var fiber = Fiber.current;

  this._connection = new Connection();

  this._connection.on('keyboard-interactive', function next(name, instructions,
                                    instructionsLang, prompts, finish, answers) {
    answers = answers || [];

    var currentPrompt = prompts[answers.length];

    if(answers.length &lt; prompts.length) {
      new Fiber(function() {
        var answer = self.prompt(currentPrompt.prompt, { hidden: !currentPrompt.echo });
        answers.push(answer);

        next(name, instructions, instructionsLang, prompts, finish, answers);
      }).run();
    } else {
      finish(answers);
    }
  });

  this._connection.on('ready', function() {
    fiber.run();
  });

  this._connection.on('error', function(err) {
    return fiber.throwInto(err);
  });

  this._connection.connect(config);

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.errors" id="apidoc.module.flightplan.errors">module flightplan.errors</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.errors.AbortedError" id="apidoc.element.flightplan.errors.AbortedError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>AbortedError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbortedError(message) {
  AbortedError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * ```javascript
 * plan.abort('Severe turbulences over the atlantic ocean!');
 * ```
 *
 * @method abort([message])
 */
Flightplan.prototype.abort = function(message) {
  throw new errors.<span class="apidocCodeKeywordSpan">AbortedError</span>(message || 'Flightplan aborted');
};

Flightplan.prototype.availableTargets = function() {
  return Object.keys(this._targets);
};

Flightplan.prototype.availableTasks = function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.BaseError" id="apidoc.element.flightplan.errors.BaseError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>BaseError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function BaseError(message) {
  BaseError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.message = message;
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

expect(LOGGER_STUB.error.lastCall.args[0]).to.equal(ERROR.stack);
expect(process.exit.calledOnce).to.be.true;
expect(process.exit.lastCall.args[0]).to.equal(1);
    });

    it('should catch uncaught custom errors and exit', function() {
var ERROR = new errors.<span class="apidocCodeKeywordSpan">BaseError</span>('some custom error');

var fn = process.on.withArgs('uncaughtException').lastCall.args[1];

fn(ERROR);

expect(LOGGER_STUB.error.lastCall.args[0]).to.equal(ERROR.message);
expect(process.exit.calledOnce).to.be.true;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.CommandExitedAbnormallyError" id="apidoc.element.flightplan.errors.CommandExitedAbnormallyError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>CommandExitedAbnormallyError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function CommandExitedAbnormallyError(message) {
  CommandExitedAbnormallyError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  if(result.code === 0) {
    self._logger.success('ok');
  } else if(options.failsafe) {
    self._logger.warn('failed safely (' + result.code + ')');
  } else {
    self._logger.error('failed (' + result.code + ')');

    var error = new errors.<span class="apidocCodeKeywordSpan">CommandExitedAbnormallyError</span>(
                'Command exited abnormally on ' + self._context.remote.host);

    return fiber.throwInto(error);
  }

  fiber.run(result);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.ConnectionFailedError" id="apidoc.element.flightplan.errors.ConnectionFailedError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>ConnectionFailedError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ConnectionFailedError(message) {
  ConnectionFailedError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
logger.info("Connecting to '" + _context.remote.host + "'");

try {
  var connection = new SSH(_context);
  _connections.push(connection);
} catch(e) {
  if(!_context.remote.failsafe) {
    throw new errors.<span class="apidocCodeKeywordSpan">ConnectionFailedError</span>("Error connecting to '" +
                          _context.remote.host + "': " + e.message);
  }

  logger.warn("Safely failed connecting to '" +
                _context.remote.host + "': " + e.message);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.InvalidArgumentError" id="apidoc.element.flightplan.errors.InvalidArgumentError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidArgumentError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function InvalidArgumentError(message) {
  InvalidArgumentError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return Fiber.yield();
};

Shell.prototype.transfer = function(files, remoteDir, options) {
options = extend(extend({}, this._options), options); // clone and extend

if(!remoteDir) {
  throw new errors.<span class="apidocCodeKeywordSpan">InvalidArgumentError</span>('Missing remote path for transfer()'
;);
}

if(Array.isArray(files)) {
  files = files.join('\n');
} else if(files instanceof Object) {
  if(!files.hasOwnProperty('stdout')) {
    throw new errors.InvalidArgumentError('Invalid object passed to transfer()');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.InvalidTargetError" id="apidoc.element.flightplan.errors.InvalidTargetError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>InvalidTargetError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function InvalidTargetError(message) {
  InvalidTargetError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
options = options || {};

if(options.color !== undefined) {
  chalk.enabled = options.color;
}

if(!target) {
  throw new errors.<span class="apidocCodeKeywordSpan">InvalidTargetError</span>('No target specified');
}

if(Object.keys(this._targets).indexOf(target) === -1) {
  throw new errors.InvalidTargetError(
              format("'%s' is not a valid target", target));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.errors.ProcessInterruptedError" id="apidoc.element.flightplan.errors.ProcessInterruptedError">
        function <span class="apidocSignatureSpan">flightplan.errors.</span>ProcessInterruptedError
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ProcessInterruptedError(message) {
  ProcessInterruptedError.super_.call(this, message);
  Error.captureStackTrace(this, this.constructor);
  this.name = this.constructor.name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function Flightplan() {
this._targets = {};
this._flights = [];

this.runtime = Object.freeze({});

process.on('SIGINT', function() {
  throw new errors.<span class="apidocCodeKeywordSpan">ProcessInterruptedError</span>('Flightplan was interrupted');
});

process.on('uncaughtException', function(err) {
  logger.error(err instanceof errors.BaseError ? err.message : err.stack);

  process.exit(1);
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.local" id="apidoc.module.flightplan.local">module flightplan.local</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.local.run" id="apidoc.element.flightplan.local.run">
        function <span class="apidocSignatureSpan">flightplan.local.</span>run
        <span class="apidocSignatureSpan">(fn, context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (fn, context) {
  var _context = extend({}, context);
  _context.remote = { host: 'localhost' };

  var future = new Future();

  var task = function() {
    var transport = new Shell(_context);

    new Fiber(function() {
      fn(transport);
      return future.return();
    }).run();

    return future;
  };

  var t = process.hrtime();

  logger.info('Executing local task');

  Future.wait(task());

  logger.info('Local task finished after ' + prettyTime(process.hrtime(t)));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      'Available targets:\n' +
      '  ' + instance.availableTargets().join('\n  ') + '\n'
    );

    process.exit(1);
  }

  instance.<span class="apidocCodeKeywordSpan">run</span>(task, target, options);
};

cli.launch({
  configPath: options.flightplan
}, invoke);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.remote" id="apidoc.module.flightplan.remote">module flightplan.remote</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.remote.disconnect" id="apidoc.element.flightplan.remote.disconnect">
        function <span class="apidocSignatureSpan">flightplan.remote.</span>disconnect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disconnect = function () {
  _connections.forEach(function(connection) {
    connection.close();
  });

  _connections = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   // Execute flights
   var t = process.hrtime();

   flights.forEach(function(f) {
     flight.run(f.type, f.fn, context);
   });

   flight.<span class="apidocCodeKeywordSpan">disconnect</span>();

   logger.info('Flightplan finished after ' + prettyTime(process.hrtime(t)));
 }).run();
};

/**
* Manually abort the current flightplan and prevent any further commands and
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.remote.run" id="apidoc.element.flightplan.remote.run">
        function <span class="apidocSignatureSpan">flightplan.remote.</span>run
        <span class="apidocSignatureSpan">(fn, context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (fn, context) {
  if(_connections.length === 0) {
    Future.wait(context.hosts.map(function(host) {
      var _context = extend({}, context);
      _context.remote = host;

      return connect(_context);
    }));
  }

  Future.wait(_connections.map(function(connection) {
    return execute(connection, fn);
  }));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      'Available targets:\n' +
      '  ' + instance.availableTargets().join('\n  ') + '\n'
    );

    process.exit(1);
  }

  instance.<span class="apidocCodeKeywordSpan">run</span>(task, target, options);
};

cli.launch({
  configPath: options.flightplan
}, invoke);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.shell" id="apidoc.module.flightplan.shell">module flightplan.shell</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.shell.shell" id="apidoc.element.flightplan.shell.shell">
        function <span class="apidocSignatureSpan">flightplan.</span>shell
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Shell(context) {
  Shell.super_.call(this, context);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.shell.super_" id="apidoc.element.flightplan.shell.super_">
        function <span class="apidocSignatureSpan">flightplan.shell.</span>super_
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transport(context) {
  this._context = context;
  this._options = {
    silent: false,
    failsafe: false
  };
  this._execWith = '';

  this._logger = logger({
    debug: this._context.options.debug,
    prefix: this._context.remote.host
  });

  this.runtime = Object.freeze(extend({}, this._context.remote)); // userland

  commands.forEach(function(command) {
    this[command] = function(args, options) {
      if(typeof args === 'object') {
        options = args;
        args = null;
      }

      var _command = format('%s%s', this._execWith, command);
      _command = args ? format('%s %s', _command, args) : _command;

      return this._exec(_command, options || {});
    };
  }, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.shell.prototype" id="apidoc.module.flightplan.shell.prototype">module flightplan.shell.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.shell.prototype._exec" id="apidoc.element.flightplan.shell.prototype._exec">
        function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>_exec
        <span class="apidocSignatureSpan">(command, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_exec = function (command, options) {
  options = options || {};

  var self = this;

  options = extend(extend({}, self._options), options); // clone and extend

  var result = {
    code: 0,
    stdout: null,
    stderr: null
  };

  self._logger.command(command);

  var fiber = Fiber.current;

  var proc = exec(command, extend({ maxBuffer: 1000 * 1024 }, options.exec));

  proc.stdout.on('data', function(data) {
    result.stdout = (result.stdout || '') + data;
  });

  proc.stderr.on('data', function(data) {
    result.stderr = (result.stderr || '') + data;
  });

  byline(proc.stdout).on('data', function(data) {
    if(!options.silent) {
      self._logger.stdout(String(data).trim());
    }
  });

  byline(proc.stderr).on('data', function(data) {
    self._logger[options.failsafe ? 'stdwarn' : 'stderr'](String(data));
  });

  proc.on('close', function(code) {
    result.code = code;

    if(result.code === 0) {
      self._logger.success('ok');
    } else if(options.failsafe) {
      self._logger.warn('failed safely (' + result.code + ')');
    } else {
      self._logger.error('failed (' + result.code + ')');

      var error = new errors.CommandExitedAbnormallyError(
                  'Command exited abnormally on ' + self._context.remote.host);

      return fiber.throwInto(error);
    }

    fiber.run(result);
  });

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

  it('should set up the `runtime` property', function() {
    expect(transport.runtime).to.deep.equal(CONTEXT.remote);
  });

  it('should throw when an abstract method gets called', function() {
    expect(function() { transport.<span class="apidocCodeKeywordSpan">_exec</span>(); } ).to.throw(Error, 'does not implement
');
    expect(function() { transport.transfer(); } ).to.throw(Error, 'does not implement');
  });
});

describe('#exec()', function() {
  it('should pass the correct command to #_exec()', function() {
    transport._exec = sinon.stub();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.shell.prototype.transfer" id="apidoc.element.flightplan.shell.prototype.transfer">
        function <span class="apidocSignatureSpan">flightplan.shell.prototype.</span>transfer
        <span class="apidocSignatureSpan">(files, remoteDir, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">transfer = function (files, remoteDir, options) {
  options = extend(extend({}, this._options), options); // clone and extend

  if(!remoteDir) {
    throw new errors.InvalidArgumentError('Missing remote path for transfer()');
  }

  if(Array.isArray(files)) {
    files = files.join('\n');
  } else if(files instanceof Object) {
    if(!files.hasOwnProperty('stdout')) {
      throw new errors.InvalidArgumentError('Invalid object passed to transfer()');
    }

    files = files.stdout;
  }

  files = (files || '').trim().replace(/[\r|\0]/mg, '\n');

  if(!files) {
    throw new errors.InvalidArgumentError('Empty file list passed to transfer()');
  }

  var tmpFile = writeTempFile(files);

  var rsyncFlags = '-az' + (this._context.options.debug ? 'vv' : '');
  var results = [];

  var self = this;

  var task = function(remote) {
    var sshFlags = (remote.privateKey ? ' -i ' + remote.privateKey : '');
    var remoteUrl = util.format('%s%s:%s',
                              (remote.username ? remote.username + '@' : ''),
                              remote.host, remoteDir);

    var command = util.format('rsync --files-from %s %s --rsh="ssh -p%s%s" ./ %s',
                              tmpFile, rsyncFlags,
                              remote.port || 22, sshFlags, remoteUrl);

    var future = new Future();

    new Fiber(function() {
      results.push(self.exec(command, options));

      return future.return();
    }).run();

    return future;
  };

  var tasks = [];
  self._context.hosts.forEach(function(remote) {
    tasks.push(task(remote));
  });

  Future.wait(tasks);

  fs.unlink(tmpFile);

  return results;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
plan.local(function(local) {
local.log('Run build');
local.exec('gulp build');

local.log('Copy files to remote hosts');
var filesToCopy = local.exec('git ls-files', {silent: true});
// rsync files to all the target's remote hosts
local.<span class="apidocCodeKeywordSpan">transfer</span>(filesToCopy, '/tmp/' + tmpDir);
});

// run commands on the target's remote hosts
plan.remote(function(remote) {
remote.log('Move folder to web root');
remote.sudo('cp -R /tmp/' + tmpDir + ' ~', {user: 'www'});
remote.rm('-rf /tmp/' + tmpDir);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.ssh" id="apidoc.module.flightplan.ssh">module flightplan.ssh</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.ssh.ssh" id="apidoc.element.flightplan.ssh.ssh">
        function <span class="apidocSignatureSpan">flightplan.</span>ssh
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SSH(context) {
  SSH.super_.call(this, context);

  var config = extend({}, context.remote); // clone

  if(config.tryKeyboard !== false) {
    config.tryKeyboard = true;
    config.readyTimeout = config.readyTimeout || 30000;
  }

  if(config.privateKey) {
    config.privateKey = fs.readFileSync(config.privateKey, { encoding: 'utf8' });
  }

  var self = this;

  var fiber = Fiber.current;

  this._connection = new Connection();

  this._connection.on('keyboard-interactive', function next(name, instructions,
                                    instructionsLang, prompts, finish, answers) {
    answers = answers || [];

    var currentPrompt = prompts[answers.length];

    if(answers.length &lt; prompts.length) {
      new Fiber(function() {
        var answer = self.prompt(currentPrompt.prompt, { hidden: !currentPrompt.echo });
        answers.push(answer);

        next(name, instructions, instructionsLang, prompts, finish, answers);
      }).run();
    } else {
      finish(answers);
    }
  });

  this._connection.on('ready', function() {
    fiber.run();
  });

  this._connection.on('error', function(err) {
    return fiber.throwInto(err);
  });

  this._connection.connect(config);

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.ssh.super_" id="apidoc.element.flightplan.ssh.super_">
        function <span class="apidocSignatureSpan">flightplan.ssh.</span>super_
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transport(context) {
  this._context = context;
  this._options = {
    silent: false,
    failsafe: false
  };
  this._execWith = '';

  this._logger = logger({
    debug: this._context.options.debug,
    prefix: this._context.remote.host
  });

  this.runtime = Object.freeze(extend({}, this._context.remote)); // userland

  commands.forEach(function(command) {
    this[command] = function(args, options) {
      if(typeof args === 'object') {
        options = args;
        args = null;
      }

      var _command = format('%s%s', this._execWith, command);
      _command = args ? format('%s %s', _command, args) : _command;

      return this._exec(_command, options || {});
    };
  }, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.flightplan.ssh.prototype" id="apidoc.module.flightplan.ssh.prototype">module flightplan.ssh.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.flightplan.ssh.prototype._exec" id="apidoc.element.flightplan.ssh.prototype._exec">
        function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>_exec
        <span class="apidocSignatureSpan">(command, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_exec = function (command, options) {
  options = options || {};

  var self = this;

  options = extend(extend({}, self._options), options); // clone and extend

  var result = {
    code: 0,
    stdout: null,
    stderr: null
  };

  self._logger.command(command);

  var fiber = Fiber.current;

  self._connection.exec(command, options.exec || {}, function(err, stream) {

    stream.on('data', function(data) {
      result.stdout = (result.stdout || '') + data;
    });

    stream.stderr.on('data', function(data) {
      result.stderr = (result.stderr || '') + data;
    });

    byline(stream, { keepEmptyLines: true }).on('data', function(data) {
      if(!options.silent) {
        self._logger.stdout(data);
      }
    });

    byline(stream.stderr, { keepEmptyLines: true }).on('data', function(data) {
      self._logger[options.failsafe ? 'stdwarn' : 'stderr'](data);
    });

    stream.on('exit', function(code) {
      result.code = code;
    });

    stream.on('end', function() {
      if(result.code === 0) {
        self._logger.success('ok');
      } else if(options.failsafe) {
        self._logger.warn('failed safely (' + result.code + ')');
      } else {
        self._logger.error('failed (' + result.code + ')');

        var error = new errors.CommandExitedAbnormallyError(
                  'Command exited abnormally on ' + self._context.remote.host);

        return fiber.throwInto(error);
      }

      fiber.run(result);
    });
  });

  return Fiber.yield();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

  it('should set up the `runtime` property', function() {
    expect(transport.runtime).to.deep.equal(CONTEXT.remote);
  });

  it('should throw when an abstract method gets called', function() {
    expect(function() { transport.<span class="apidocCodeKeywordSpan">_exec</span>(); } ).to.throw(Error, 'does not implement
');
    expect(function() { transport.transfer(); } ).to.throw(Error, 'does not implement');
  });
});

describe('#exec()', function() {
  it('should pass the correct command to #_exec()', function() {
    transport._exec = sinon.stub();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.flightplan.ssh.prototype.close" id="apidoc.element.flightplan.ssh.prototype.close">
        function <span class="apidocSignatureSpan">flightplan.ssh.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  this._connection.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    expect(LOGGER_STUB.debug.lastCall.args[0]).to.equal('test message');
  });
});

describe('#close()', function() {
  it('should be an function', function() {
    expect(transport.close).to.be.a('function');
    expect(transport.<span class="apidocCodeKeywordSpan">close</span>()).to.be.undefined;
  });
});

describe('command shortcuts', function() {
  it('should be exposed', function() {
    COMMANDS.forEach(function(command) {
      expect(transport[command]).to.be.a('function');
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>